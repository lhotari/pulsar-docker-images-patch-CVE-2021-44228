# arguments that can be overridden on the command line with build-arg
# for example --build-arg=ORIGINAL_IMAGE=apachepulsar/pulsar-all:2.7.3
ARG ORIGINAL_IMAGE=apachepulsar/pulsar-all:2.8.1

# original docker image
FROM ${ORIGINAL_IMAGE}

# remove log4j
RUN rm -rf /pulsar/lib/org.apache.logging.log4j*.jar /pulsar/lib/log4j*.jar

# copy log4j 2.15.0 to /pulsar/lib
COPY lib /pulsar/lib

# add also environment based workaround to mitigate possible shaded log4j libraries in Pulsar Functions
# see https://twitter.com/brunoborges/status/1469462412679991300 about LOG4J_FORMAT_MSG_NO_LOOKUPS=true
ENV LOG4J_FORMAT_MSG_NO_LOOKUPS=true
